# Story CL2-001: IMind Interface & Base Types

**Story ID:** CL2-001
**Epic:** EPIC-CLONE-LAB-V2
**Phase:** 1 - Foundation
**Status:** Done
**Points:** 3
**Author:** Morgan (PM)

---

## Description

Criar a interface base `IMind` e tipos fundamentais para o sistema de 8 Minds. Esta é a fundação técnica que todas as minds irão implementar.

### Problem Statement
O Clone Lab v2.0 precisa de uma abstração comum para que todas as minds possam ser orquestradas de forma uniforme, permitindo análise especializada por dimensão da personalidade.

---

## Acceptance Criteria

```gherkin
Given I am developing a new Mind
When I implement the IMind interface
Then I must have access to all required methods and types

Given the Mind system is initialized
When an analysis is requested
Then the system can identify which mind to route to

Given multiple minds exist
When they need to share context
Then a common MindContext type is available
```

---

## Technical Requirements

### Interface Definition

```typescript
// packages/minds/src/base/mind.interface.ts

export type MindId = 'tim' | 'daniel' | 'brene' | 'barbara' | 'charlie' | 'constantin' | 'quinn' | 'victoria';

export interface MindPersona {
  id: MindId;
  name: string;
  inspiration?: string;          // Real person inspiration
  expertise: string[];
  tone: 'analytical' | 'empathetic' | 'pragmatic' | 'visionary';
}

export interface MindContext {
  extractedData: ExtractedData[];
  previousResults?: Map<MindId, MindResult>;
  options: Record<string, unknown>;
  sessionId: string;
}

export interface MindResult {
  mindId: MindId;
  traits: PersonalityTrait[];
  confidence: number;
  evidence: Evidence[];
  recommendations: string[];
  metadata: Record<string, unknown>;
}

export interface PersonalityTrait {
  category: string;
  name: string;
  value: string | number | boolean;
  confidence: number;
  sources: string[];             // IDs of source content
}

export interface Evidence {
  source: string;
  excerpt: string;
  relevance: number;
}

export interface IMind {
  readonly persona: MindPersona;

  // Core analysis method
  analyze(context: MindContext): Promise<MindResult>;

  // Validate own results
  validate(result: MindResult): Promise<ValidationResult>;

  // Can this mind handle the given context?
  canHandle(context: MindContext): boolean;

  // Get required dependencies
  getDependencies(): MindId[];
}
```

### File Structure

```
packages/minds/
├── src/
│   ├── base/
│   │   ├── mind.interface.ts    # This story
│   │   ├── types.ts             # Shared types
│   │   └── index.ts             # Exports
│   └── index.ts
├── package.json
└── tsconfig.json
```

---

## Business Value

Esta story estabelece a **fundação técnica** para todo o sistema de 8 Minds. Sem uma interface comum, cada mind seria implementada de forma inconsistente, dificultando orquestração e manutenção.

**Benefícios:**
- Padronização de todas as 8 minds
- Habilita orquestração automática pelo Orchestrator
- Reduz tempo de desenvolvimento das stories CL2-002 a CL2-009
- Facilita testes com mocks padronizados

---

## Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Interface muito rígida | Medium | High | Design extensível com tipos genéricos |
| Breaking changes futuros | Low | High | Versionamento de interface desde início |
| Tipos não serializáveis | Low | Medium | Validar serialização JSON no DoD |

---

## Scope

### In Scope
- IMind interface definition
- MindPersona, MindContext, MindResult types
- PersonalityTrait and Evidence types
- Package setup (package.json, tsconfig.json)
- Base exports

### Out of Scope
- Actual Mind implementations (CL2-002 to CL2-009)
- Orchestrator (CL2-010)
- Testing framework setup

---

## Dependencies

| Dependency | Type | Status |
|------------|------|--------|
| TypeScript 5.x | Runtime | Available |
| @clone-lab/core types | Package | Available |

---

## Dev Notes

- Use Zod for runtime validation of MindResult
- Ensure types are serializable for potential distributed execution
- Consider future streaming support in analyze()
- **Implementation Notes (Dex):**
  - Created monorepo structure with npm workspaces (pnpm not available)
  - Added SerializableMindContext type for JSON serialization (Map → Record)
  - Created @clone-lab/core as supporting package
  - Extended interface with optional initialize(), dispose(), healthCheck() methods
  - CodeRabbit skipped: WSL not available in current environment

---

## File List

| File | Action | Status |
|------|--------|--------|
| `packages/minds/package.json` | Create | Done |
| `packages/minds/tsconfig.json` | Create | Done |
| `packages/minds/src/base/mind.interface.ts` | Create | Done |
| `packages/minds/src/base/types.ts` | Create | Done |
| `packages/minds/src/base/index.ts` | Create | Done |
| `packages/minds/src/index.ts` | Create | Done |
| `package.json` (root) | Create | Done |
| `tsconfig.base.json` | Create | Done |
| `packages/core/package.json` | Create | Done |
| `packages/core/tsconfig.json` | Create | Done |
| `packages/core/src/index.ts` | Create | Done |
| `packages/core/src/extracted-data.ts` | Create | Done |
| `packages/core/src/config.ts` | Create | Done |
| `eslint.config.js` | Create | Done |

---

## Definition of Done

- [x] Interface compiles without errors
- [x] All types exported correctly
- [x] Package builds successfully (`npm run build`)
- [x] Types usable from other packages
- [x] JSDoc documentation complete
- [x] Types são serializáveis em JSON (SerializableMindContext para distribuição)
- [x] Lint passa sem erros (ESLint v10 configurado)
- [x] Code review aprovado (Quinn - QA Agent)

---

## QA Checklist

- [x] Interface compiles without errors
- [x] All types exported correctly
- [x] Package builds successfully
- [x] Types usable from other packages
- [x] JSDoc documentation complete

---

## Change Log

| Date | Author | Description |
|------|--------|-------------|
| 2026-02-20 | Morgan (PM) | Story created |
| 2026-02-20 | Dex (Dev) | Implementation complete - created monorepo structure, @clone-lab/minds and @clone-lab/core packages |
| 2026-02-20 | Quinn (QA) | QA review passed - all acceptance criteria met, ready for merge |

---

## Completion Notes

**Agent Model:** Claude (GLM-5)

**Summary:**
- Created monorepo structure with npm workspaces
- Implemented IMind interface with full JSDoc documentation
- Created supporting types (MindPersona, MindContext, MindResult, PersonalityTrait, Evidence)
- Added SerializableMindContext for JSON serialization
- Created @clone-lab/core package as foundation

**Technical Debt Created:**
- [x] ~~ESLint configuration needed for lint validation~~ (DONE)
- [ ] Testing framework setup (deferred to future story)

**Decisions Made:**
1. npm workspaces over pnpm (pnpm not available in environment)
2. Map in MindContext for performance, Record in SerializableMindContext for serialization
3. Optional lifecycle methods (initialize, dispose, healthCheck) added to IMind

**Items Not Done:**
- ~~Lint validation: ESLint not configured~~ (DONE)
- ~~CodeRabbit review: WSL not available~~ (Skipped - QA manual review completed)

---

## DoD Checklist Final

| Category | Status | Notes |
|----------|--------|-------|
| Requirements Met | ✅ PASS | All interfaces and types implemented |
| Coding Standards | ✅ PASS | ESLint v10 configured and passing |
| Testing | N/A | Out of scope per story |
| Verification | ✅ PASS | Build, typecheck, lint pass |
| Story Admin | ✅ PASS | Complete |
| Dependencies | ✅ PASS | Zod added, npm audit clean |
| Documentation | ✅ PASS | JSDoc complete |

**Story Status: Done**

---

## QA Results

**Reviewed by:** Quinn (QA Agent)
**Date:** 2026-02-20
**Verdict:** ✅ PASS

### Acceptance Criteria Verification

| AC | Status | Evidence |
|----|--------|----------|
| AC1: IMind interface | ✅ PASS | 4 required + 3 optional methods |
| AC2: Mind routing | ✅ PASS | MindId union + canHandle() |
| AC3: Shared context | ✅ PASS | MindContext + SerializableMindContext |

### Quality Gate Summary

| Check | Result |
|-------|--------|
| Build | ✅ Pass |
| TypeCheck | ✅ Pass |
| Lint | ✅ Pass |
| Documentation | ✅ Complete |
| Serialization | ✅ Supported |

### Observations (Non-Blocking)

1. Zod runtime validation deferred to Orchestrator story
2. Date serialization handled via SerializableMindContext

**Recommendation:** Ready for merge. Activate @devops to push.

---

*Story generated by Morgan (PM Agent) - AIOS Framework*
