# Story CL2-013: Extraction Tasks EX-001 to EX-010

**Story ID:** CL2-013
**Epic:** EPIC-CLONE-LAB-V2
**Phase:** 2 - Validation
**Status:** Ready
**Points:** 8
**Author:** Morgan (PM)

---

## Description

Implementar as 10 Validation Tasks de Extracao (EX-001 a EX-010), responsaveis por validar a qualidade e completude dos dados extraidos das fontes.

### Problem Statement
Os dados extraidos de diversas fontes precisam ser validados quanto a qualidade, cobertura e confiabilidade antes de serem processados pelas Minds. Estas 10 tasks garantem que apenas dados de qualidade sigam no pipeline.

---

## Acceptance Criteria

```gherkin
Given extracted data from source content
When extraction tasks are executed
Then all 10 tasks return valid TaskResults

Given a source with incomplete data
When EX-001 (Source Completeness) runs
Then it identifies missing required fields

Given duplicate content across sources
When EX-005 (Duplicate Detection) runs
Then it identifies and groups duplicates

Given extracted data with all 10 tasks passing
When results are aggregated
Then an overall extraction quality score is available
```

---

## Technical Requirements

### Task Definitions

| Task ID | Name | Description |
|---------|------|-------------|
| EX-001 | Source Completeness | Valida completude dos dados extraidos |
| EX-002 | Source Quality Score | Avalia qualidade da fonte original |
| EX-003 | Content Relevance | Verifica relevancia do conteudo |
| EX-004 | Temporal Coverage | Analisa distribuicao temporal |
| EX-005 | Duplicate Detection | Detecta conteudo duplicado |
| EX-006 | Format Validation | Valida formatos de dados |
| EX-007 | Metadata Completeness | Verifica metadados associados |
| EX-008 | Language Consistency | Verifica consistencia de idioma |
| EX-009 | Content Depth | Avalia profundidade do conteudo |
| EX-010 | Source Diversity | Avalia diversidade de fontes |

### Implementation Example

```typescript
// packages/validation/src/tasks/extraction/ex-001-source-completeness.ts

import { IValidationTask, TaskContext, TaskResult, TaskDefinition } from '../task.interface';

export class EX001SourceCompleteness implements IValidationTask {
  readonly definition: TaskDefinition = {
    id: 'EX-001',
    category: 'extraction',
    name: 'Source Completeness',
    description: 'Validates that extracted data contains all required fields',
    requiredInputs: ['extractedData'],
    outputs: ['completenessScore', 'missingFields'],
    timeout: 30000,
    retryable: true,
    priority: 'critical'
  };

  async execute(context: TaskContext): Promise<TaskResult> {
    const startTime = Date.now();
    const findings: TaskFinding[] = [];
    let score = 100;
    const missingFields: string[] = [];

    for (const data of context.extractedData) {
      const requiredFields = this.getRequiredFields(data.type);
      for (const field of requiredFields) {
        if (!data.content[field]) {
          missingFields.push(field);
          findings.push({
            type: 'warning',
            description: `Missing field: ${field} in ${data.id}`,
            severity: 'medium'
          });
          score -= 5;
        }
      }
    }

    return {
      taskId: this.definition.id,
      status: score >= 60 ? 'passed' : 'failed',
      score: Math.max(0, score),
      confidence: this.calculateConfidence(context.extractedData.length),
      findings,
      recommendations: this.generateRecommendations(missingFields),
      executionTime: Date.now() - startTime,
      metadata: { missingFields, totalSources: context.extractedData.length }
    };
  }

  async validateInputs(context: TaskContext): Promise<boolean> {
    return context.extractedData.length > 0;
  }

  canExecute(context: TaskContext): boolean {
    return context.extractedData.length > 0;
  }

  getDependencies(): TaskId[] {
    return []; // No dependencies
  }

  private getRequiredFields(type: string): string[] {
    const fieldMap: Record<string, string[]> = {
      'video': ['title', 'transcript', 'duration', 'channel'],
      'article': ['title', 'content', 'author', 'date'],
      'podcast': ['title', 'transcript', 'duration', 'host'],
      'tweet': ['content', 'author', 'date'],
      'book': ['title', 'content', 'author', 'chapters']
    };
    return fieldMap[type] || ['content'];
  }

  private calculateConfidence(sampleSize: number): number {
    return Math.min(1, sampleSize / 10);
  }

  private generateRecommendations(missingFields: string[]): string[] {
    if (missingFields.length === 0) return [];
    return [`Review extraction process to capture: ${[...new Set(missingFields)].join(', ')}`];
  }
}
```

### File Structure

```
packages/validation/src/tasks/extraction/
├── ex-001-source-completeness.ts
├── ex-002-source-quality.ts
├── ex-003-content-relevance.ts
├── ex-004-temporal-coverage.ts
├── ex-005-duplicate-detection.ts
├── ex-006-format-validation.ts
├── ex-007-metadata-completeness.ts
├── ex-008-language-consistency.ts
├── ex-009-content-depth.ts
├── ex-010-source-diversity.ts
├── index.ts
└── __tests__/
    └── extraction-tasks.test.ts
```

---

## Business Value

As Extraction Tasks sao a **primeira barreira de qualidade** no pipeline. Dados de baixa qualidade resultam em clones de baixa fidelidade.

**Beneficios:**
- Detecta problemas de qualidade cedo no pipeline
- Evita processamento de dados incompletos
- Fornece metricas objetivas de qualidade de extracao
- Habilita feedback automatico para melhorias

---

## Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Falsos positivos na validacao | Medium | Medium | Thresholds configuraveis |
| Performance com muitos sources | Medium | Low | Processamento em batches |
| Dependencia de tipos de fonte | Low | Medium | Mapeamento extensivel de tipos |

---

## Scope

### In Scope
- All 10 extraction task implementations
- Unit tests for each task
- Task execution scoring logic
- Finding and recommendation generation

### Out of Scope
- Task Registry & Executor
- Other task categories
- CLI integration

---

## Dependencies

| Dependency | Type | Status |
|------------|------|--------|
| CL2-012 (Task Interface) | Package | Pending |
| @clone-lab/extractors types | Package | Available |

---

## Dev Notes

- Use factory pattern for task instantiation
- Implement shared validation helpers
- Consider caching for duplicate detection
- Add telemetry for performance monitoring

---

## File List

| File | Action | Status |
|------|--------|--------|
| `packages/validation/src/tasks/extraction/ex-001-source-completeness.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-002-source-quality.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-003-content-relevance.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-004-temporal-coverage.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-005-duplicate-detection.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-006-format-validation.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-007-metadata-completeness.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-008-language-consistency.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-009-content-depth.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/ex-010-source-diversity.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/index.ts` | Create | Pending |
| `packages/validation/src/tasks/extraction/__tests__/extraction-tasks.test.ts` | Create | Pending |

---

## Definition of Done

- [ ] All 10 tasks implement IValidationTask correctly
- [ ] Each task returns valid TaskResult
- [ ] Scores are reasonable (0-100)
- [ ] Findings are descriptive and actionable
- [ ] Unit tests pass (coverage > 80%)
- [ ] Handles edge cases gracefully
- [ ] Lint passa sem erros
- [ ] Code review aprovado

---

## QA Checklist

- [ ] All 10 tasks execute without errors
- [ ] Task results are consistent
- [ ] Scores reflect actual quality
- [ ] Findings are accurate
- [ ] Recommendations are helpful
- [ ] Edge cases handled

---

## Change Log

| Date | Author | Description |
|------|--------|-------------|
| 2026-02-20 | Morgan (PM) | Story created |

---

*Story generated by Morgan (PM Agent) - AIOS Framework*
