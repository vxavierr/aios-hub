# Story CL2-012: Validation Task Interface

**Story ID:** CL2-012
**Epic:** EPIC-CLONE-LAB-V2
**Phase:** 2 - Validation
**Status:** Ready
**Points:** 3
**Author:** Morgan (PM)

---

## Description

Criar a interface base `IValidationTask` e tipos fundamentais para o sistema de 63 Validation Tasks. Esta é a fundação técnica que todas as tasks de validacao irao implementar.

### Problem Statement
O Clone Lab v2.0 precisa de uma abstracao comum para que todas as 63 validation tasks possam ser executadas de forma uniforme pelo Task Registry e Executor, permitindo validacao granular por categoria.

---

## Acceptance Criteria

```gherkin
Given I am developing a new Validation Task
When I implement the IValidationTask interface
Then I must have access to all required methods and types

Given the Validation system is initialized
When a task is executed
Then the system can track execution status and results

Given multiple tasks exist in a category
When they are executed
Then a common TaskResult type is available for aggregation
```

---

## Technical Requirements

### Interface Definition

```typescript
// packages/validation/src/tasks/task.interface.ts

export type TaskCategory = 'extraction' | 'behavioral' | 'values' | 'cognitive' | 'synthesis' | 'implementation' | 'quality';

export type TaskId =
  // Extraction tasks (EX-001 to EX-010)
  | 'EX-001' | 'EX-002' | 'EX-003' | 'EX-004' | 'EX-005'
  | 'EX-006' | 'EX-007' | 'EX-008' | 'EX-009' | 'EX-010'
  // Behavioral tasks (BH-001 to BH-012)
  | 'BH-001' | 'BH-002' | 'BH-003' | 'BH-004' | 'BH-005' | 'BH-006'
  | 'BH-007' | 'BH-008' | 'BH-009' | 'BH-010' | 'BH-011' | 'BH-012'
  // Values tasks (VL-001 to VL-008)
  | 'VL-001' | 'VL-002' | 'VL-003' | 'VL-004' | 'VL-005'
  | 'VL-006' | 'VL-007' | 'VL-008'
  // Cognitive tasks (CG-001 to CG-011)
  | 'CG-001' | 'CG-002' | 'CG-003' | 'CG-004' | 'CG-005' | 'CG-006'
  | 'CG-007' | 'CG-008' | 'CG-009' | 'CG-010' | 'CG-011'
  // Synthesis tasks (SY-001 to SY-009)
  | 'SY-001' | 'SY-002' | 'SY-003' | 'SY-004' | 'SY-005'
  | 'SY-006' | 'SY-007' | 'SY-008' | 'SY-009'
  // Implementation tasks (IM-001 to IM-007)
  | 'IM-001' | 'IM-002' | 'IM-003' | 'IM-004' | 'IM-005'
  | 'IM-006' | 'IM-007'
  // Quality tasks (QA-001 to QA-006)
  | 'QA-001' | 'QA-002' | 'QA-003' | 'QA-004' | 'QA-005' | 'QA-006';

export interface TaskDefinition {
  id: TaskId;
  category: TaskCategory;
  name: string;
  description: string;
  requiredInputs: string[];
  outputs: string[];
  timeout: number;              // Max execution time in ms
  retryable: boolean;
  priority: 'critical' | 'high' | 'medium' | 'low';
}

export interface TaskContext {
  sessionId: string;
  sourceId: string;
  extractedData: ExtractedData[];
  previousResults: Map<TaskId, TaskResult>;
  options: Record<string, unknown>;
}

export interface TaskResult {
  taskId: TaskId;
  status: 'pending' | 'running' | 'passed' | 'failed' | 'skipped';
  score: number;                // 0-100
  confidence: number;           // 0-1
  findings: TaskFinding[];
  recommendations: string[];
  executionTime: number;        // ms
  error?: string;
  metadata: Record<string, unknown>;
}

export interface TaskFinding {
  type: 'issue' | 'warning' | 'info' | 'strength';
  description: string;
  severity: 'critical' | 'high' | 'medium' | 'low';
  evidence?: string;
}

export interface IValidationTask {
  readonly definition: TaskDefinition;

  // Core execution method
  execute(context: TaskContext): Promise<TaskResult>;

  // Validate inputs before execution
  validateInputs(context: TaskContext): Promise<boolean>;

  // Can this task run given the current context?
  canExecute(context: TaskContext): boolean;

  // Get required dependencies
  getDependencies(): TaskId[];
}
```

### File Structure

```
packages/validation/
├── src/
│   ├── tasks/
│   │   ├── task.interface.ts    # This story
│   │   ├── types.ts             # Shared task types
│   │   └── index.ts             # Exports
│   └── index.ts
├── package.json
└── tsconfig.json
```

---

## Business Value

Esta story estabelece a **fundacao tecnica** para todas as 63 Validation Tasks. Sem uma interface comum, cada task seria implementada de forma inconsistente, dificultando execucao e agregacao de resultados.

**Beneficios:**
- Padronizacao de todas as 63 tasks
- Habilita execucao automatica pelo Task Registry
- Reduz tempo de desenvolvimento das stories CL2-013 a CL2-019
- Facilita testes com mocks padronizados

---

## Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Interface muito rigida | Medium | High | Design extensivel com tipos genericos |
| Breaking changes futuros | Low | High | Versionamento de interface desde inicio |
| Tipos nao serializaveis | Low | Medium | Validar serializacao JSON no DoD |

---

## Scope

### In Scope
- IValidationTask interface definition
- TaskDefinition, TaskContext, TaskResult types
- TaskFinding type
- Package setup (package.json, tsconfig.json)
- Base exports

### Out of Scope
- Actual Task implementations (CL2-013 to CL2-019)
- Task Registry & Executor (CL2-020)
- Checkpoint Manager (CL2-021)

---

## Dependencies

| Dependency | Type | Status |
|------------|------|--------|
| TypeScript 5.x | Runtime | Available |
| @clone-lab/core types | Package | Available |
| @clone-lab/minds types | Package | Pending (Phase 1) |

---

## Dev Notes

- Use Zod for runtime validation of TaskResult
- Ensure types are serializable for potential distributed execution
- Consider future streaming support in execute()

---

## File List

| File | Action | Status |
|------|--------|--------|
| `packages/validation/package.json` | Create | Pending |
| `packages/validation/tsconfig.json` | Create | Pending |
| `packages/validation/src/tasks/task.interface.ts` | Create | Pending |
| `packages/validation/src/tasks/types.ts` | Create | Pending |
| `packages/validation/src/tasks/index.ts` | Create | Pending |
| `packages/validation/src/index.ts` | Create | Pending |

---

## Definition of Done

- [ ] Interface compiles without errors
- [ ] All types exported correctly
- [ ] Package builds successfully (`pnpm build`)
- [ ] Types usable from other packages
- [ ] JSDoc documentation complete
- [ ] Types sao serializaveis em JSON
- [ ] Lint passa sem erros
- [ ] Code review aprovado

---

## QA Checklist

- [ ] Interface compiles without errors
- [ ] All types exported correctly
- [ ] Package builds successfully
- [ ] Types usable from other packages
- [ ] JSDoc documentation complete

---

## Change Log

| Date | Author | Description |
|------|--------|-------------|
| 2026-02-20 | Morgan (PM) | Story created |

---

*Story generated by Morgan (PM Agent) - AIOS Framework*
