# Story TD-014: Loading States e Error Boundaries

> **Story ID:** TD-014
> **Epic:** EPIC-TD-001 (Technical Debt Resolution)
> **Status:** Done
> **Priority:** P3 - Médio
> **Estimate:** 4 horas
> **Assignee:** @dev

---

## Description

Implementar loading states e error boundaries para melhorar a experiência do usuário durante operações assíncronas e erros.

### Problem Statement

Não havia tratamento visual consistente para estados de carregamento e erros, resultando em UX pobre quando dados demoravam para carregar ou falhavam.

## Acceptance Criteria

```gherkin
Feature: Loading States

Scenario: Loading spinner visível
  Given uma operação assíncrona está em andamento
  When o componente está carregando
  Then deve exibir LoadingSpinner com mensagem opcional

Scenario: Skeleton placeholders
  Given o conteúdo está carregando
  When uso Skeleton
  Then deve exibir placeholder visual similar ao conteúdo real

Feature: Error Handling

Scenario: Error Boundary captura erros
  Given um erro de React ocorre
  When o ErrorBoundary está envolvendo o componente
  Then deve exibir UI de fallback sem crashar a app

Scenario: ErrorMessage com retry
  Given um erro de API ocorre
  When exibo ErrorMessage
  Then deve mostrar mensagem clara
  And botão de retry visível se onRetry fornecido
```

## Scope

### In Scope

- ErrorBoundary component (class component)
- Skeleton component (text, circular, rectangular, card)
- ErrorMessage component (card, inline, toast variants)
- useAsync hook para gerenciar estados
- useFetch hook para fetch com refetch

### Out of Scope

- Toast notifications system
- Error tracking service (Sentry)
- Offline detection

## Tasks

- [x] Criar ErrorBoundary component
- [x] Criar Skeleton component
- [x] Criar CardSkeleton, TableSkeleton, HealthScoreSkeleton presets
- [x] Criar ErrorMessage component
- [x] Criar useAsync hook
- [x] Criar useFetch hook
- [x] Atualizar components/index.js exports
- [x] LoadingSpinner já existente

## File List

| Arquivo | Ação | Status |
|---------|------|--------|
| `src/components/ErrorBoundary.jsx` | Criar | ✅ Criado |
| `src/components/Skeleton.jsx` | Criar | ✅ Criado |
| `src/components/ErrorMessage.jsx` | Criar | ✅ Criado |
| `src/hooks/useAsync.js` | Criar | ✅ Criado |
| `src/components/index.js` | Atualizar | ✅ Atualizado |

## Dev Notes

### ErrorBoundary Uso

```jsx
<ErrorBoundary
  fallback={<CustomError />}
  onError={(error, info) => logError(error)}
  onRetry={() => refetch()}
>
  <MyComponent />
</ErrorBoundary>
```

### useAsync Hook

```jsx
const { data, error, isLoading, execute } = useAsync(
  () => fetchData(),
  { immediate: true }
);

if (isLoading) return <Skeleton />;
if (error) return <ErrorMessage error={error} onRetry={execute} />;
return <DataDisplay data={data} />;
```

### Skeleton Variants

- `text` - Linhas de texto
- `circular` - Avatares, scores circulares
- `rectangular` - Cards, imagens
- `card` - Card placeholder completo

### ErrorMessage Variants

- `card` - Card centralizado
- `inline` - Em linha com ícone
- `toast` - Notificação flutuante

## Definition of Done

- [x] ErrorBoundary implementado
- [x] Skeleton components criados
- [x] ErrorMessage com variantes
- [x] useAsync/useFetch hooks
- [x] Exports atualizados
- [x] Story atualizada

---

*Story criada e completada por @dev | Epic EPIC-TD-001*
*Synkra AIOS v4.2.13*
