# Story 3.1: Script de Scan de Stories

**Status:** Draft
**Epic:** Epic 3 - Story Scanner
**Story ID:** HUB-3.1

---

## Executor Assignment

```yaml
executor: "@dev"
quality_gate: "@qa"
quality_gate_tools: [code_review, performance_validation, error_handling]
```

---

## Story

**As a** AIOS Master,
**I want** um script que escaneie `docs/stories/` de cada projeto,
**So that** eu tenha visibilidade completa de todas as stories em andamento.

---

## Acceptance Criteria

1. Script `scan-stories.js` criado em `.aios-core/scripts/`
2. Script lê todos os arquivos `*.md` em `docs/stories/` de cada projeto
3. Script extrai: título, status, epic, progresso (checkboxes)
4. Script gera `.aios/hub-stories.json` consolidado
5. Script completa em < 10 segundos para 5 projetos com 20 stories cada
6. Unit tests para o script

---

## Tasks / Subtasks

- [ ] Task 1: Criar estrutura básica do script (AC: #1)
  - [ ] Criar arquivo `.aios-core/scripts/scan-stories.js`
  - [ ] Implementar classe `ScanStories`
  - [ ] Exportar módulo

- [ ] Task 2: Implementar descoberta de stories (AC: #2)
  - [ ] Método `discoverStoryFiles()` para encontrar `*.md` em `docs/stories/`
  - [ ] Suporte a subpastas (epics/)
  - [ ] Filtro para ignorar arquivos não-story (templates, etc.)

- [ ] Task 3: Implementar parser de stories (AC: #3)
  - [ ] Método `parseStoryFile()` para extrair metadados
  - [ ] Extrair título (primeiro heading ou frontmatter)
  - [ ] Extrair status (campo Status: ou **Status:**)
  - [ ] Extrair epic reference
  - [ ] Extrair progresso (contar checkboxes [x] vs [ ])

- [ ] Task 4: Implementar consolidação (AC: #4)
  - [ ] Método `consolidateStories()` para agrupar por projeto
  - [ ] Gerar `.aios/hub-stories.json` com schema definido
  - [ ] Incluir timestamp de sync

- [ ] Task 5: Otimizar performance (AC: #5)
  - [ ] Usar Promise.all para leitura paralela
  - [ ] Implementar cache de filesystem
  - [ ] Medir e validar < 10s

- [ ] Task 6: Criar unit tests (AC: #6)
  - [ ] Test: parse de story válida
  - [ ] Test: parse de story sem status
  - [ ] Test: contagem de checkboxes
  - [ ] Test: consolidação de múltiplos projetos

---

## Dev Notes

### Schema de hub-stories.json

```json
{
  "version": "1.0",
  "lastSync": "2026-02-20T10:30:00.000Z",
  "summary": {
    "totalStories": 15,
    "byStatus": {
      "Draft": 3,
      "Ready": 2,
      "InProgress": 5,
      "InReview": 2,
      "Done": 3
    }
  },
  "projects": {
    "projeto-alpha": {
      "lastActivity": "2026-02-20T10:00:00.000Z",
      "stories": [
        {
          "id": "1.1",
          "title": "Criar estrutura de pastas",
          "status": "Done",
          "epic": "1",
          "progress": {
            "completed": 5,
            "total": 5,
            "percentage": 100
          },
          "file": "docs/stories/1.1.story.md",
          "lastModified": "2026-02-19T15:00:00.000Z"
        }
      ]
    }
  }
}
```

### Story File Patterns

O parser deve reconhecer:

1. **Status patterns:**
   - `**Status:** Done`
   - `Status: InProgress`
   - `Status: Draft`

2. **Title patterns:**
   - Primeiro `# Heading`
   - Frontmatter `title:`

3. **Progress patterns:**
   - Contar `- [x]` vs `- [ ]`
   - Ignorar checkboxes em code blocks

### Dependencies

- `js-yaml` para frontmatter (se presente)
- `fs/promises` para operações async
- `path` para resolução de paths

### Testing

- Test file location: `.aios-core/scripts/__tests__/scan-stories.test.js`
- Usar fixtures com stories de exemplo
- Mock filesystem para testes isolados

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-20 | 1.0 | Story created | Orion (@aios-master) |

---

*Part of Epic 3 - Story Scanner*
