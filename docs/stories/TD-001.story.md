# Story TD-001: Remover .env do Git e Rotacionar Credenciais

> **Story ID:** TD-001
> **Epic:** EPIC-TD-001 (Technical Debt Resolution)
> **Status:** Done
> **Priority:** P0 - Crítico
> **Estimate:** 1 hora
> **Assignee:** @dev

---

## Description

O arquivo `.env` está trackeado no repositório git do HUB, expondo credenciais potencialmente sensíveis. Esta story remove o arquivo do controle de versão, atualiza o .gitignore, e rotaciona quaisquer credenciais que possam ter sido comprometidas.

### Problem Statement

Credenciais expostas em repositórios git são um risco de segurança crítico. Mesmo que o repositório seja privado, o histórico de commits preserva as credenciais, e qualquer pessoa com acesso ao repo pode vê-las.

## Acceptance Criteria

```gherkin
Feature: Remover .env do git

Scenario: Arquivo .env removido do tracking
  Given o arquivo .env existe na raiz do HUB
  When executo os comandos de remoção
  Then o .env não deve estar mais trackeado pelo git
  And o .env deve permanecer no sistema de arquivos local

Scenario: .gitignore atualizado
  Given o arquivo .gitignore existe
  When verifico seu conteúdo
  Then deve conter a entrada ".env"
  And a entrada não deve estar comentada

Scenario: Histório limpo de credenciais
  Given o histórico do git pode conter .env
  When verifico com git log ou BFG
  Then não deve haver arquivos .env no histórico
  Or devo documentar que BFG é necessário

Scenario: Credenciais rotacionadas
  Given o .env continha credenciais
  When listo os serviços afetados
  Then cada credencial deve ter sido rotacionada
  And o novo .env deve conter as novas credenciais
```

## Scope

### In Scope

- Remover .env do tracking do git
- Atualizar .gitignore
- Verificar histórico de commits
- Rotacionar credenciais expostas
- Documentar serviços afetados

### Out of Scope

- Remover .env do histórico (BFG Repo-Cleaner) - será story separada se necessário
- Auditoria de segurança completa
- Implementar secret scanning

## Tasks

- [x] Verificar conteúdo atual do .env — N/A (não estava trackeado)
- [x] Listar serviços/credenciais afetados — Nenhum afetado
- [x] Remover .env do tracking: `git rm --cached .env` — Não necessário
- [x] Verificar/atualizar .gitignore — Já contém .env (linha 4)
- [x] Commit da remoção — Não necessário
- [x] Rotacionar cada credencial listada — Não necessário (não expostas)
- [x] Atualizar .env local com novas credenciais — Não necessário
- [x] Documentar em Change Log

## File List

| Arquivo | Ação | Status |
|---------|------|--------|
| `.env` | Remover do tracking (manter local) | ✅ Já não estava trackeado |
| `.gitignore` | Atualizar se necessário | ✅ Já contém .env |

## Dev Notes

### Investigação Realizada (2026-02-20)

```bash
# Verificar se .env está trackeado
$ git ls-files .env
(vazio - NÃO trackeado)

# Verificar histórico
$ git log --all --full-history -- .env
(vazio - NUNCA commitado)

# Verificar .gitignore
$ grep "\.env" .gitignore
.env  # ✅ Presente na linha 4

# Verificar todos os .env no workspace
$ find . -name ".env" -type f
./.env
./projects/clone-ai/.env

# Confirmar que nenhum está trackeado
$ git ls-files | grep -E "\.env$"
(vazio)
```

### Conclusão

O débito técnico SYS-003 foi identificado erroneamente ou já foi resolvido anteriormente. O arquivo `.env`:
- Não está trackeado pelo git
- Nunca foi commitado (histórico limpo)
- Está corretamente no .gitignore
- Credenciais não foram expostas no repositório

**Nenhuma ação de segurança é necessária.**

## QA Notes

- Verificar que .env não aparece em `git ls-files`
- Verificar que .env existe localmente após operação
- Confirmar que novas credenciais funcionam

## Risks

| Risco | Probabilidade | Mitigação |
|-------|---------------|-----------|
| Credenciais já vazadas em forks | Baixa | Verificar forks conhecidos |
| Serviço down durante rotação | Baixa | Rotacionar um por um |
| Credencial esquecida | Média | Checklist de serviços |

## Definition of Done

- [x] .env não está mais trackeado pelo git — Confirmado via `git ls-files .env`
- [x] .gitignore contém .env — Linha 4 do .gitignore
- [x] Todas as credenciais rotacionadas — N/A (não foram expostas)
- [x] Novas credenciais funcionando — N/A
- [x] Commit realizado — Não necessário (débito não existia)
- [x] Story atualizada com resultado

## Change Log

| Data | Agente | Mudança |
|------|--------|---------|
| 2026-02-20 | @dev | Investigação inicial: `git ls-files .env` retornou vazio |
| 2026-02-20 | @dev | Histórico verificado: nenhum .env foi commitado |
| 2026-02-20 | @dev | .gitignore verificado: já contém .env |
| 2026-02-20 | @dev | **Conclusão:** O débito SYS-003 não existe ou foi resolvido anteriormente |
| 2026-02-20 | @dev | Story marcada como Done - sem ação necessária |

---

*Story criada por @pm | Epic EPIC-TD-001*
*Synkra AIOS v4.2.13*
