# Story 2.2: Comando *create-project

**Status:** Done
**Epic:** Epic 2 - Hub Commands
**Story ID:** HUB-2.2

---

## Executor Assignment

```yaml
executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: [project_structure_validation, aios_init, registry_sync]
```

---

## Story

**As a** JoÃ£o (Hub Owner),
**I want** um comando para criar novos projetos com AIOS isolado,
**So that** eu possa iniciar novos projetos rapidamente.

---

## Acceptance Criteria

1. Comando `*create-project {nome}` adicionado ao AIOS Master
2. Cria pasta `projects/{nome}/`
3. Inicializa `.aios-core/` com configuraÃ§Ã£o bÃ¡sica
4. Cria `project-status.yaml` inicial
5. Registra projeto no entity-registry via sync-projects.js
6. Pergunta template: greenfield, brownfield, ou custom

---

## ğŸ¤– CodeRabbit Integration

### Story Type Analysis

**Primary Type:** CLI
**Secondary Type(s):** Scaffold
**Complexity:** Medium

### Specialized Agent Assignment

**Primary Agents:**
- @dev: Implementar comando

**Supporting Agents:**
- @architect: Validar estrutura criada

### Quality Gate Tasks

- [x] Pre-Commit (@dev): Testar criaÃ§Ã£o de projeto end-to-end
- [ ] Pre-PR (@devops): N/A

### Self-Healing Configuration

**Expected Self-Healing:**
- Primary Agent: @dev (light mode)
- Max Iterations: 2
- Timeout: 15 minutes
- Severity Filter: CRITICAL, HIGH

### CodeRabbit Focus Areas

**Primary Focus:**
- Directory creation safety
- Template copying integrity
- Registry sync after creation

**Secondary Focus:**
- Error handling for existing projects
- Input validation for project names

---

## Tasks / Subtasks

- [x] Task 1: Adicionar comando ao AIOS Master (AC: #1)
  - [x] Editar `.aios-core/development/agents/aios-master.md`
  - [x] Adicionar comando `create-project` com argumento `{nome}`
  - [x] Definir visibility: [full, quick, key]

- [x] Task 2: Criar task handler para create-project (AC: #2)
  - [x] Criar `.aios-core/development/tasks/hub-create-project.md`
  - [x] Validar nome do projeto (alfanumÃ©rico, sem espaÃ§os)
  - [x] Verificar se projeto jÃ¡ existe
  - [x] Criar pasta `projects/{nome}/`

- [x] Task 3: Inicializar .aios-core/ (AC: #3)
  - [x] Criar estrutura mÃ­nima de diretÃ³rios
  - [x] Criar `core-config.yaml` com configuraÃ§Ã£o bÃ¡sica
  - [x] Criar pastas: data/, development/, scripts/
  - [x] Copiar templates bÃ¡sicos se necessÃ¡rio

- [x] Task 4: Criar project-status.yaml inicial (AC: #4)
  - [x] Criar pasta `.aios/` no projeto
  - [x] Criar arquivo com estrutura inicial
  - [x] Definir status: active
  - [x] Definir lastActivity: now

- [x] Task 5: Sincronizar com registry (AC: #5)
  - [x] Executar sync-projects.js apÃ³s criaÃ§Ã£o
  - [x] Verificar registro no entity-registry.yaml
  - [x] Verificar hub-context.json atualizado

- [x] Task 6: Implementar seleÃ§Ã£o de template (AC: #6)
  - [x] Perguntar tipo: greenfield, brownfield, custom
  - [x] Aplicar configuraÃ§Ãµes especÃ­ficas do template
  - [x] Criar estrutura de pastas conforme template

---

## Dev Notes

### Relevant Architecture

Do documento `docs/architecture/hub-multi-projeto-architecture.md`:

**Estrutura de projeto criado:**

```
projects/{nome}/
â”œâ”€â”€ .aios-core/
â”‚   â”œâ”€â”€ core-config.yaml      â† ConfiguraÃ§Ã£o bÃ¡sica
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ .gitkeep
â”‚   â”œâ”€â”€ development/
â”‚   â”‚   â””â”€â”€ .gitkeep
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ .gitkeep
â”œâ”€â”€ .aios/
â”‚   â””â”€â”€ project-status.yaml   â† Status inicial
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ stories/
â”‚   â”‚   â””â”€â”€ .gitkeep
â”‚   â””â”€â”€ prd/
â”‚       â””â”€â”€ .gitkeep
â””â”€â”€ src/                      â† Conforme template
    â””â”€â”€ .gitkeep
```

**Template core-config.yaml:**

```yaml
project:
  name: "{nome}"
  type: greenfield | brownfield | custom
  created: "2026-02-19T10:30:00.000Z"
  hub: true  # Indica que Ã© gerenciado pelo Hub

aios:
  version: "3.0"
  mode: "project"  # NÃ£o Ã© hub
```

**Template project-status.yaml:**

```yaml
version: "1.0"
project:
  name: "{nome}"
  status: active
  created: "2026-02-19T10:30:00.000Z"
status:
  currentEpic: null
  currentStory: null
  lastUpdate: "2026-02-19T10:30:00.000Z"
  modifiedFilesTotalCount: 0
  modifiedFiles: []
```

### Templates DisponÃ­veis

| Template | DescriÃ§Ã£o | Estrutura |
|----------|-----------|-----------|
| greenfield | Projeto novo do zero | src/, tests/, docs/ |
| brownfield | Projeto existente | Preserva estrutura atual |
| custom | MÃ­nimo necessÃ¡rio | Apenas .aios-core/ |

### Dependencies

- `fs` para criaÃ§Ã£o de diretÃ³rios
- `sync-projects.js` para registro
- Templates em `.aios-core/product/templates/project-*`

### Testing

- Testar criaÃ§Ã£o com nome vÃ¡lido
- Testar erro com nome invÃ¡lido
- Testar erro com projeto existente
- Testar cada template

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-19 | 1.0 | Story created | River (@sm) |

---

## Dev Agent Record

### Agent Model Used
Claude GLM-4 (glm-5)

### Debug Log References
N/A - ImplementaÃ§Ã£o sem erros

### Completion Notes
- Script cria estrutura completa de projeto AIOS
- 3 templates suportados: greenfield, brownfield, custom
- ValidaÃ§Ã£o de nome: apenas lowercase, nÃºmeros, hÃ­fen, underscore
- SincronizaÃ§Ã£o automÃ¡tica com registry apÃ³s criaÃ§Ã£o
- Cleanup automÃ¡tico em caso de falha

### File List
**Created:**
- .aios-core/scripts/hub-create-project.js
- .aios-core/development/tasks/hub-create-project.md
- projects/teste-alpha/ (test project - can be removed)

**Modified:**
- .aios-core/development/agents/aios-master.md (commands + dependencies)
- docs/stories/2.2.create-project-command.md (checkboxes, Dev Agent Record)

---

## QA Results

### Review Date: 2026-02-20
### Reviewer: Quinn (@qa)

### Acceptance Criteria Verification

| AC # | Description | Status | Notes |
|------|-------------|--------|-------|
| 1 | Comando `*create-project` adicionado | âœ… PASS | Comando registrado em aios-master.md |
| 2 | Cria pasta `projects/{nome}/` | âœ… PASS | Verificado com projeto teste-alpha |
| 3 | Inicializa `.aios-core/` | âœ… PASS | core-config.yaml, data/, development/, scripts/ |
| 4 | Cria `project-status.yaml` inicial | âœ… PASS | Status: active, timestamps corretos |
| 5 | Registra via sync-projects.js | âœ… PASS | hub-context.json atualizado |
| 6 | Templates: greenfield, brownfield, custom | âœ… PASS | 3 templates suportados |

### Code Quality Review

| Aspect | Rating | Notes |
|--------|--------|-------|
| Input Validation | âœ… GOOD | Valida nome (regex, tamanho, caracteres) |
| Error Handling | âœ… GOOD | Cleanup automÃ¡tico em caso de falha |
| Code Structure | âœ… GOOD | FunÃ§Ãµes modulares bem organizadas |
| Template System | âœ… GOOD | 3 templates com estruturas diferentes |

### Security Considerations

- âœ… Path traversal protegido por validaÃ§Ã£o de nome
- âœ… Projeto existente verificado antes de criar
- âœ… Cleanup em caso de falha

### Test Evidence

Projeto `teste-alpha` criado e verificado:
```
projects/teste-alpha/
â”œâ”€â”€ .aios-core/
â”‚   â”œâ”€â”€ core-config.yaml
â”‚   â”œâ”€â”€ data/.gitkeep
â”‚   â”œâ”€â”€ development/.gitkeep
â”‚   â””â”€â”€ scripts/.gitkeep
â”œâ”€â”€ .aios/project-status.yaml
â”œâ”€â”€ docs/stories/.gitkeep
â”œâ”€â”€ docs/prd/.gitkeep
â”œâ”€â”€ src/.gitkeep
â””â”€â”€ tests/.gitkeep
```

### Gate Decision: **PASS**

Todos os acceptance criteria atendidos. ValidaÃ§Ã£o de input robusta, error handling com cleanup.

â€” Quinn, guardiÃ£o da qualidade ğŸ›¡ï¸
