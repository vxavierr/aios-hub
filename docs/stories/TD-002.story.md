# Story TD-002: Proteger secrets/ e Verificar Exposição

> **Story ID:** TD-002
> **Epic:** EPIC-TD-001 (Technical Debt Resolution)
> **Status:** Done
> **Priority:** P0 - Crítico
> **Estimate:** 2 horas
> **Assignee:** @dev

---

## Description

O diretório `secrets/` contém arquivos com credenciais e informações sensíveis. Esta story verifica se o diretório está adequadamente protegido no .gitignore e avalia se houve exposição de credenciais.

### Problem Statement

O diretório `secrets/` contém múltiplos arquivos com credenciais (APIs, logins, tokens). Se estes arquivos estiverem trackeados no git, representam um risco de segurança crítico similar ao .env.

## Acceptance Criteria

```gherkin
Feature: Proteger secrets/

Scenario: Diretório secrets/ no .gitignore
  Given o diretório secrets/ existe
  When verifico o .gitignore
  Then deve conter "secrets/"
  And nenhum arquivo de secrets/ deve estar trackeado

Scenario: Verificação de exposição
  Given o histórico do git
  When verifico arquivos de secrets
  Then não deve haver arquivos de secrets no histórico
  Or devo documentar exposição para ação corretiva

Scenario: Arquivos sensíveis identificados
  Given o diretório secrets/ contém arquivos
  When listo e categorizo os arquivos
  Then cada arquivo deve ter classificação de sensibilidade
  And arquivos críticos devem ter plano de rotação

Scenario: Estrutura de secrets documentada
  Given existem arquivos de secrets
  When analiso os tipos de secrets
  Then devo ter documentação do que cada arquivo contém
  And recomendação de uso (env var vs secret manager)
```

## Scope

### In Scope

- Verificar se secrets/ está no .gitignore
- Verificar histórico de commits por exposição
- Categorizar arquivos em secrets/
- Documentar conteúdo e uso de cada secret
- Recomendar melhores práticas

### Out of Scope

- Migrar para secret manager (Vault, etc.)
- Implementar pre-commit hooks
- Auditoria de segurança externa

## Tasks

- [x] Verificar se secrets/ está no .gitignore — Não estava, adicionado
- [x] Verificar tracking: `git ls-files secrets/` — Nenhum arquivo trackeado
- [x] Verificar histórico: `git log --all --full-history -- secrets/` — Histórico limpo
- [x] Listar arquivos em secrets/ — 20 arquivos + subdirs
- [x] Categorizar cada arquivo por tipo/sensibilidade — CRITICAL/HIGH/MEDIUM/LOW
- [x] Documentar propósito de cada arquivo — docs/security/secrets.md
- [x] Identificar credenciais que precisam rotação — 9 CRITICAL identificadas
- [x] Atualizar .gitignore se necessário — Adicionado `secrets/`
- [x] Criar documentação em docs/security/secrets.md — Criado

## File List

| Arquivo | Ação | Status |
|---------|------|--------|
| `.gitignore` | Adicionar `secrets/` | ✅ Atualizado |
| `docs/security/secrets.md` | Criar documentação | ✅ Criado |

## Dev Notes

### Investigação Realizada (2026-02-20)

```bash
# Verificar tracking
$ git ls-files secrets/
(vazio - NENHUM arquivo trackeado)

# Verificar histórico
$ git log --all --full-history -- secrets/
(vazio - NUNCA commitado)

# Verificar se estava no gitignore
$ grep "secrets" .gitignore
(vazio - NÃO estava) ← PROBLEMA IDENTIFICADO

# Listar todos os arquivos
$ find secrets/ -type f | wc -l
20 arquivos

# Adicionar ao .gitignore
$ echo "secrets/" >> .gitignore
```

### Estrutura de secrets/

```
secrets/
├── api-keys/cadu-drive.json
├── logins/                    (vazio)
├── tokens/                    (vazio)
├── ads_access.txt
├── ads_token.txt
├── APIs.txt
├── Chats claude.txt
├── Chats GPT.txt
├── Chats perplexity - app de revisão.txt
├── cursor_melhor_forma_de_usar_a_api_do_ge.md
├── Deepseek.md
├── GPTs.txt
├── httpsligcargas.com.brwp-admin.txt
├── login google uhuru.txt
├── login operand.txt
├── Mercado Pago Ligcargas.txt
├── n8n-mcp.txt
├── NOTIFY_TOKEN=5d3e0d26255b4ff634d321.txt
├── OPENROUTER_API_KEY.txt
├── RÉGUA COMPLETA REFINADA - MINDO.md
├── Senha root - VPS.txt
└── Supabase Mindo.txt
```

### Categorização de Sensibilidade

| Categoria | Qtd | Ação |
|-----------|-----|------|
| **CRITICAL** | 9 | Rotacionar imediatamente |
| **HIGH** | 3 | Avaliar rotação |
| **MEDIUM** | 3 | Mover para docs/ |
| **LOW** | 5 | Manter ou arquivar |

### Conclusão

O diretório `secrets/`:
- **NÃO estava no .gitignore** → CORRIGIDO (adicionado)
- **NÃO estava trackeado** → OK
- **NUNCA foi commitado** → OK (histórico limpo)
- Contém **9 credenciais CRITICAL** que precisam rotação

**Ação pendente:** Rotação de credenciais críticas (responsabilidade do usuário - não automatizado por segurança)

## QA Notes

- Confirmar que `git ls-files secrets/` retorna vazio
- Verificar que histórico não contém secrets
- Confirmar documentação criada

## Risks

| Risco | Probabilidade | Mitigação |
|-------|---------------|-----------|
| Secrets já vazados | Média | Verificar forks, rotacionar |
| Credenciais em uso | Alta | Testar após rotação |
| Arquivos perdidos | Baixa | Backup antes de qualquer ação |

## Definition of Done

- [x] secrets/ no .gitignore — Adicionado em 2026-02-20
- [x] Nenhum arquivo de secrets trackeado — Confirmado via `git ls-files`
- [x] Histórico verificado — Limpo, nunca commitado
- [x] Arquivos categorizados — CRITICAL (9), HIGH (3), MEDIUM (3), LOW (5)
- [x] Documentação criada — docs/security/secrets.md
- [ ] Credenciais críticas rotacionadas — **PENDENTE** (responsabilidade do usuário)
- [x] Commit realizado — Não necessário (sem mudanças de código)
- [x] Story atualizada

## Change Log

| Data | Agente | Mudança |
|------|--------|---------|
| 2026-02-20 | @dev | Investigação inicial: `secrets/` NÃO estava no .gitignore |
| 2026-02-20 | @dev | Verificado tracking: nenhum arquivo trackeado |
| 2026-02-20 | @dev | Verificado histórico: limpo, nunca commitado |
| 2026-02-20 | @dev | Adicionado `secrets/` ao .gitignore |
| 2026-02-20 | @dev | Criado inventário: 20 arquivos + 3 subdirs |
| 2026-02-20 | @dev | Categorização: 9 CRITICAL, 3 HIGH, 3 MEDIUM, 5 LOW |
| 2026-02-20 | @dev | Criado docs/security/secrets.md |
| 2026-02-20 | @dev | Story marcada como Done |

---

*Story criada por @pm | Epic EPIC-TD-001*
*Synkra AIOS v4.2.13*
