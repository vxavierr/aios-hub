# Story TD-009: Configurar CI/CD para Health Dashboard

> **Story ID:** TD-009
> **Epic:** EPIC-TD-001 (Technical Debt Resolution)
> **Status:** Done
> **Priority:** P2 - Alto
> **Estimate:** 4 horas
> **Assignee:** @dev

---

## Description

Configurar pipelines de CI/CD usando GitHub Actions para o Health Dashboard, automatizando testes, lint, build e deploy.

### Problem Statement

O Health Dashboard não tinha automação de CI/CD, exigindo processos manuais para testar, construir e fazer deploy da aplicação.

## Acceptance Criteria

```gherkin
Feature: CI/CD Pipeline

Scenario: CI em Pull Requests
  Given um PR é aberto
  When o CI executa
  Then lint deve passar
  And testes devem passar
  And build deve ser gerado

Scenario: Deploy em main/master
  Given código é mergeado em main
  When o workflow executa
  Then build deve ser gerado
  And deploy para GitHub Pages deve ocorrer

Scenario: Release em tags
  Given uma tag v* é criada
  When o workflow executa
  Then release deve ser criado no GitHub
  And assets devem ser anexados
```

## Scope

### In Scope

- Workflow de CI (lint, test, build)
- Workflow de deploy para GitHub Pages
- Workflow de release
- Configurar base path dinâmico

### Out of Scope

- Deploy para outros ambientes (Vercel, Netlify, AWS)
- Testes E2E automatizados
- Preview deployments em PRs

## Tasks

- [x] Criar diretório .github/workflows
- [x] Criar ci.yml (lint, test, build)
- [x] Criar deploy.yml (GitHub Pages)
- [x] Criar release.yml (tags)
- [x] Atualizar vite.config.js para base path dinâmico
- [x] Configurar GITHUB_PAGES env var

## File List

| Arquivo | Ação | Status |
|---------|------|--------|
| `.github/workflows/ci.yml` | Criar workflow CI | ✅ Criado |
| `.github/workflows/deploy.yml` | Criar workflow deploy | ✅ Criado |
| `.github/workflows/release.yml` | Criar workflow release | ✅ Criado |
| `vite.config.js` | Adicionar base path dinâmico | ✅ Atualizado |

## Dev Notes

### Workflows Criados

#### ci.yml
- **Triggers:** push para main/master/develop, PRs
- **Jobs:** lint, test, build
- **Artifacts:** coverage report, dist/

#### deploy.yml
- **Triggers:** push para main/master, workflow_dispatch
- **Jobs:** build, deploy
- **Target:** GitHub Pages

#### release.yml
- **Triggers:** tags v*
- **Jobs:** test, build, create release
- **Assets:** dist/

### Configuração do Vite

```javascript
export default defineConfig(({ mode }) => {
  const isGitHubPages = process.env.GITHUB_PAGES === 'true';
  const repoName = process.env.GITHUB_REPOSITORY?.split('/')[1] || 'health-dashboard';

  return {
    base: isGitHubPages ? `/${repoName}/` : '/',
    // ...
  };
});
```

### Como Usar

1. **CI automático:** Abra um PR ou push para branches monitoradas
2. **Deploy:** Push para main/master aciona deploy para GitHub Pages
3. **Release:** Crie uma tag `git tag v1.0.0 && git push --tags`

### Status Badges (adicionar ao README)

```markdown
![CI](https://github.com/org/repo/actions/workflows/ci.yml/badge.svg)
![Deploy](https://github.com/org/repo/actions/workflows/deploy.yml/badge.svg)
```

## Definition of Done

- [x] CI workflow criado
- [x] Deploy workflow criado
- [x] Release workflow criado
- [x] Base path dinâmico configurado
- [x] Workflows documentados
- [x] Story atualizada

## Change Log

| Data | Agente | Mudança |
|------|--------|---------|
| 2026-02-20 | @dev | Criar .github/workflows/ |
| 2026-02-20 | @dev | Criar ci.yml (lint, test, build) |
| 2026-02-20 | @dev | Criar deploy.yml (GitHub Pages) |
| 2026-02-20 | @dev | Criar release.yml (tags) |
| 2026-02-20 | @dev | Atualizar vite.config.js |
| 2026-02-20 | @dev | Story marcada como Done |

---

*Story criada e completada por @dev | Epic EPIC-TD-001*
*Synkra AIOS v4.2.13*
