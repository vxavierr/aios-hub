# Story TD-006: Configurar Testes de UI com Testing Library

> **Story ID:** TD-006
> **Epic:** EPIC-TD-001 (Technical Debt Resolution)
> **Status:** Done
> **Priority:** P1 - Urgente
> **Estimate:** 6 horas
> **Assignee:** @dev

---

## Description

Configurar infraestrutura de testes de UI para o Health Dashboard usando Vitest e Testing Library, permitindo testes unitários e de integração dos componentes React.

### Problem Statement

O Health Dashboard não tinha testes automatizados, dificultando a detecção de regressões e a manutenção do código.

## Acceptance Criteria

```gherkin
Feature: Infraestrutura de Testes

Scenario: Vitest configurado
  Given o projeto precisa de testes
  When verifico a configuração
  Then vitest deve estar instalado
  And vitest.config.js deve existir
  And npm test deve funcionar

Scenario: Testing Library configurado
  Given os componentes React precisam ser testados
  When verifico as dependências
  Then @testing-library/react deve estar instalado
  And @testing-library/jest-dom deve estar instalado
  And @testing-library/user-event deve estar instalado

Scenario: Testes básicos criados
  Given os componentes principais existem
  When executo os testes
  Then Card.test.jsx deve existir
  And StatusBadge.test.jsx deve existir
  And HealthScore.test.jsx deve existir
```

## Scope

### In Scope

- Instalar Vitest e Testing Library
- Criar configuração de testes
- Criar setup de testes (jsdom, mocks)
- Criar testes para componentes principais
- Criar testes para hooks

### Out of Scope

- 100% de cobertura de testes
- Testes E2E (Playwright/Cypress)
- Testes de integração completos
- CI/CD para testes

## Tasks

- [x] Instalar vitest
- [x] Instalar @testing-library/react
- [x] Instalar @testing-library/jest-dom
- [x] Instalar @testing-library/user-event
- [x] Instalar jsdom
- [x] Criar vitest.config.js
- [x] Criar src/test/setup.js
- [x] Criar mocks para matchMedia, ResizeObserver, IntersectionObserver
- [x] Criar Card.test.jsx
- [x] Criar StatusBadge.test.jsx
- [x] Criar HealthScore.test.jsx
- [x] Criar useHealthData.test.js
- [x] Criar Dashboard.test.jsx
- [x] Adicionar scripts de test no package.json

## File List

| Arquivo | Ação | Status |
|---------|------|--------|
| `package.json` | Adicionar dependências e scripts | ✅ Atualizado |
| `vitest.config.js` | Criar configuração | ✅ Criado |
| `src/test/setup.js` | Criar setup | ✅ Criado |
| `src/components/shared/Card.test.jsx` | Criar testes | ✅ Criado |
| `src/components/shared/StatusBadge.test.jsx` | Criar testes | ✅ Criado |
| `src/components/HealthScore.test.jsx` | Criar testes | ✅ Criado |
| `src/hooks/useHealthData.test.js` | Criar testes | ✅ Criado |
| `src/pages/Dashboard.test.jsx` | Criar testes | ✅ Criado |

## Dev Notes

### Dependências Adicionadas

```json
{
  "devDependencies": {
    "@testing-library/jest-dom": "^6.4.0",
    "@testing-library/react": "^14.2.0",
    "@testing-library/user-event": "^14.5.0",
    "jsdom": "^24.0.0",
    "vitest": "^1.3.0"
  }
}
```

### Scripts Adicionados

```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run",
    "test:coverage": "vitest run --coverage"
  }
}
```

### Cobertura de Testes

| Componente | Testes | Status |
|------------|--------|--------|
| Card | 7 testes | ✅ |
| StatusBadge | 15 testes | ✅ |
| HealthScore | 7 testes | ✅ |
| useHealthData | 4 testes | ✅ |
| Dashboard | 6 testes | ✅ |
| **Total** | **39 testes** | ✅ |

### Mocks Configurados

- `window.matchMedia` - Para media queries
- `ResizeObserver` - Para componentes que observam tamanho
- `IntersectionObserver` - Para lazy loading

### Executar Testes

```bash
cd .aios-core/scripts/diagnostics/health-dashboard
npm install
npm test
```

## Definition of Done

- [x] Vitest configurado
- [x] Testing Library configurado
- [x] Setup de testes criado
- [x] Mocks configurados
- [x] 5 arquivos de teste criados
- [x] 39 testes escritos
- [x] Scripts de teste adicionados
- [x] Story atualizada

## Change Log

| Data | Agente | Mudança |
|------|--------|---------|
| 2026-02-20 | @dev | Análise da estrutura existente |
| 2026-02-20 | @dev | Instalar dependências de teste |
| 2026-02-20 | @dev | Criar vitest.config.js |
| 2026-02-20 | @dev | Criar src/test/setup.js |
| 2026-02-20 | @dev | Criar Card.test.jsx |
| 2026-02-20 | @dev | Criar StatusBadge.test.jsx |
| 2026-02-20 | @dev | Criar HealthScore.test.jsx |
| 2026-02-20 | @dev | Criar useHealthData.test.js |
| 2026-02-20 | @dev | Criar Dashboard.test.jsx |
| 2026-02-20 | @dev | Atualizar testes para API correta |
| 2026-02-20 | @dev | Story marcada como Done |

---

*Story criada e completada por @dev | Epic EPIC-TD-001*
*Synkra AIOS v4.2.13*
